<section
  data-testid="launchpad-page"
  <% if (!supply.isSoldOut && supply.hasMintable) { %>
    data-controller="mint"
    data-action="wallet:connected@window->mint#onWalletConnected wallet:disconnected@window->mint#onWalletDisconnected"
    data-mint-collection-value="<%= collection.slug %>"
    data-mint-price-value="<%= collection.price_sats %>"
    data-mint-payment-address-value="<%= collection.payment_address %>"
    data-mint-lowest-inscription-utxo-size-value="<%= collection.lowest_inscription_utxo_size %>"
    data-mint-seller-address-value="<%= launchpad.seller_address %>"
  <% } %>
>
  <% const isGallery = Boolean(collection.gallery_inscription_id) %>
  <% const bannerId = collection.gallery_inscription_id ?? collection.parent_inscription_id ?? (collection.inscription_ids ?? [])[0] %>

  <div class="collection-header" data-testid="launchpad-header">
    <h1 class="collection-title" data-testid="launchpad-title"><%= collection.title %></h1>
    <p style="opacity: 0.8; margin-bottom: 1rem;">
      <% if (isGallery) { %>
        Gallery collection with on-chain provenance.
      <% } else if (collection.parent_inscription_id) { %>
        Parent-child collection with on-chain provenance.
        <% if (parentInscription && parentInscription.isSealed) { %>
          This collection is sealed ðŸ”¥
        <% } %>
      <% } else { %>
        Launchpad collection.
      <% } %>
    </p>

    <% if (collection.gallery_inscription_id || collection.parent_inscription_id) { %>
      <div style="margin-top: 16px;">
        <a
          href="https://ordinals.com/inscription/<%= encodeURIComponent(bannerId) %>"
          target="_blank"
          rel="noopener"
          style="font-size: 0.75rem; color: var(--color-warning-bg);"
          data-testid="parent-ordinals-number-link"
        >View on ordinals.com â—‰</a>
      </div>
    <% } %>
  </div>

  <div class="detail-layout">
    <div class="detail-media" data-testid="launchpad-media" data-controller="image">
      <div class="media-frame" data-label="Preview">
        <div style="position: absolute; inset: 0; background: linear-gradient(45deg, #e0e0e0, #f0f0f0);" data-image-target="skeleton"></div>
        <% if (parentInscription && parentInscription.isImage) { %>
          <img
            src="https://ordinals.com/content/<%= encodeURIComponent(bannerId) %>"
            alt="<%= collection.title %>"
            loading="eager"
            decoding="async"
            style="image-rendering: pixelated"
            class="opacity-0 transition-opacity duration-300"
            data-image-target="img"
            data-action="load->image#loaded error->image#error"
            data-testid="launchpad-media-img"
          />
        <% } else { %>
          <iframe
            src="https://ordinals.com/preview/<%= encodeURIComponent(bannerId) %>"
            class="pointer-events-none opacity-0 transition-opacity duration-300"
            loading="eager"
            allow="accelerometer; gyroscope"
            data-image-target="media"
            data-action="load->image#loaded error->image#error"
            data-testid="launchpad-media-iframe"
          ></iframe>
        <% } %>
      </div>
    </div>

    <div>
      <turbo-frame
        id="launchpad-progress"
        src="/launchpad/<%= encodeURIComponent(collection.slug) %>/progress"
        loading="eager"
        refresh="morph"
        data-controller="frame-refresh"
        data-frame-refresh-interval-value="<%= launchpad.refresh_ms %>"
      ></turbo-frame>

      <div class="purchase-section" data-testid="purchase-panel">
        <div class="price-row">
          <span class="price-label">Price</span>
          <span class="price-value" data-testid="price-sats"><%= formatSats(collection.price_sats) %></span>
        </div>

        <% if (supply.isSoldOut) { %>
          <button class="btn btn-accent btn-block" type="button" disabled style="opacity: 0.6; margin-top: 1rem;">
            Sold Out
          </button>
        <% } else if (!supply.hasMintable) { %>
          <button class="btn btn-accent btn-block" type="button" disabled style="opacity: 0.6; margin-top: 1rem;">
            Sold Out
          </button>
        <% } else { %>
          <form method="post" data-testid="mint-form" data-mint-target="form">
            <% if (collection.op_return) { %>
              <div style="margin: 1rem 0; padding: 1rem; border: 2px dashed var(--color-muted); background: var(--color-bg);" data-testid="spam-container">
                <label for="launchpad-spam-<%= collection.slug %>" style="display: block; font-size: 0.75rem; color: var(--color-secondary); text-transform: uppercase; margin-bottom: 0.5rem;">OP_RETURN SPAM</label>
                <textarea
                  id="launchpad-spam-<%= collection.slug %>"
                  rows="3"
                  required
                  spellcheck="false"
                  autocomplete="off"
                  placeholder="Enter at least 81 bytes"
                  data-mint-target="spamInput"
                  data-action="input->mint#onSpamInput"
                  style="width: 100%; min-height: 80px; border: 2px solid var(--color-primary); background: var(--color-surface); padding: 8px; font-size: 0.8rem;"
                ></textarea>
                <div style="margin-top: 0.5rem; font-size: 0.7rem; color: var(--color-muted);">Minimum 81 bytes required.</div>
              </div>
            <% } %>
            <% if ((collection.optional_payments ?? []).length > 0) { %>
              <div class="optional-payments" data-testid="optional-payments">
                <div class="optional-payments-label">Additional Options</div>
                <% collection.optional_payments.forEach((payment) => { %>
                  <label class="optional-payment" data-testid="optional-payment">
                    <input type="checkbox" data-mint-target="optionalPayment" data-payment='<%= JSON.stringify(payment) %>' data-action="mint#calculateCost" />
                    <div class="optional-payment-title"><%= payment.title %></div>
                    <div class="optional-payment-amount"><%= formatSats(payment.amount) %></div>
                    <div class="optional-payment-desc"><%= payment.description %></div>
                  </label>
                <% }) %>
              </div>
            <% } %>

            <div class="fees-section" data-testid="fees" data-mint-target="fees">
              <div class="fee-row">
                <span>Network Fee</span>
                <span data-mint-target="fee" style="font-family: var(--font-mono);">-</span>
              </div>
              <div class="fee-row">
                <span>Fee Rate</span>
                <span data-mint-target="feeRate" style="font-family: var(--font-mono);">-</span>
              </div>
              <div class="fee-total">
                <span>Total</span>
                <span class="value" data-mint-target="total" style="font-family: var(--font-mono);">-</span>
              </div>
              <div
                class="hidden purchase-usd"
                data-usd-role="total"
                data-usd-sats=""
                style="margin-top: 0.35rem; font-size: 0.7rem; color: var(--color-muted); text-transform: uppercase; letter-spacing: 0.04em; text-align: right; font-family: var(--font-mono);"
              ></div>
            </div>

            <% if (launchpad.turnstile_site_key) { %>
              <div class="turnstile-container" style="margin-top: 1rem; display: flex; justify-content: center;">
                <div
                  class="cf-turnstile"
                  data-mint-target="turnstile"
                  data-sitekey="<%= launchpad.turnstile_site_key %>"
                  data-callback="launchpadTurnstileSuccess"
                  data-expired-callback="launchpadTurnstileExpired"
                  data-error-callback="launchpadTurnstileError"
                ></div>
              </div>
            <% } %>

            <button
              class="btn btn-primary btn-block hide-on-connected"
              type="button"
              data-mint-target="connectButton"
              data-action="wallet#select"
              style="opacity: 0.6; margin-top: 1rem;"
            >
              Connect Wallet to Mint
            </button>

            <button
              class="btn btn-secondary btn-block show-on-connected"
              type="button"
              data-mint-target="prepareButton"
              data-action="click->mint#prepare"
              style="margin-top: 1rem;"
            >
              <span style="display: inline-flex; align-items: center; justify-content: center; gap: 8px; width: 100%;">
                <span data-mint-target="prepareSpinner" class="button-spinner button-spinner-hidden"></span>
                <span data-mint-target="prepareLabel">Prepare Mint</span>
              </span>
            </button>

            <button
              class="btn btn-accent btn-block hidden"
              type="button"
              data-testid="mint-button"
              data-mint-target="mintButton"
              data-action="click->mint#mint"
              style="margin-top: 1rem;"
            >
              <span style="display: inline-flex; align-items: center; justify-content: center; gap: 8px; width: 100%;">
                <span data-mint-target="mintSpinner" class="button-spinner button-spinner-hidden"></span>
                <span data-mint-target="mintLabel">Mint</span>
              </span>
            </button>
          </form>

          <div class="hidden message message-success" data-mint-target="successPanel" data-testid="mint-success">
            <div class="message-title" data-mint-target="successTitle">Mint Successful</div>
            <a class="message-link" target="_blank" rel="noopener" data-mint-target="successLink" href="">View on mempool.space</a>
          </div>

          <div class="hidden message message-error" data-mint-target="errorPanel" data-testid="mint-client-error">
            <div class="message-title" data-mint-target="errorTitle">Error</div>
            <div class="message-link" data-mint-target="errorMessage"></div>
          </div>
        <% } %>
      </div>
    </div>
  </div>

  <turbo-frame
    id="launchpad-sales"
    src="/launchpad/<%= encodeURIComponent(collection.slug) %>/sales"
    loading="lazy"
    refresh="morph"
    target="_top"
    style="display: block; margin-top: 2rem;"
    data-controller="frame-refresh"
    data-frame-refresh-interval-value="<%= launchpad.refresh_ms %>"
  ></turbo-frame>
</section>

<% if (launchpad.turnstile_site_key) { %>
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
<% } %>
